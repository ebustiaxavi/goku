<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Joc amb disseny personalitzat</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: sans-serif;
      width: 100vw;
      height: 100vh;
      overflow: hidden; /* Evitem scroll */
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      background-color: #eee;
    }

    /* Contenidor principal: 3 columnes (esquerra, joc, dreta) */
    .main-container {
      display: flex;
      width: 100%;
      height: 100%;
    }

    /* ====== Columna esquerra i columna dreta ====== */
    .side-panel {
      width: 100px; /* Amplada fixa, pots ajustar segons convingui */
      display: flex;
      flex-direction: column;
      justify-content: space-between; /* caixa superior, marcador al centre, caixa inferior */
      align-items: center;
      background-color: #f8f8f8;
      border: 1px solid #ccc;
    }

    /* Botons de Pujar/Baixar, amb color de fons */
    .side-panel button {
      width: 80px;
      height: 135px;            /* 3 vegades més que els 45px anteriors */
      font-size: 14px;
      cursor: pointer;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #999;
    }
    /* Diferenciem colors per pujar i baixar (opcional) */
    .up-button {
      background-color: #b3d9ff; /* Blau clar */
    }
    .down-button {
      background-color: #ffb3b3; /* Vermell clar */
    }

    /* Marcador gran, al centre de la columna, color vermell */
    .score {
      color: red;
      font-weight: bold;
      text-align: center;
    }

    /* ====== Columna central: joc amb imatge de fons ====== */
    .game-container {
      position: relative;
      flex: 1;                  /* S'ocupa tot l'espai disponible */
      border: 2px solid #aaa;
      background: url("fons.png") no-repeat center center;
      background-size: cover;
      overflow: hidden;
    }

    /* PERSONATGES */
    .character {
      position: absolute;
      width: 70px;           /* Amplada base (abans d'escalar) */
      height: auto;
    }
    /* Player1: transform-origin a l'esquerra */
    #player1 {
      left: 50px;
      transform-origin: left center;
    }
    /* Player2: transform-origin a la dreta */
    #player2 {
      right: 50px;
      transform-origin: right center;
    }

    /* BALA */
    .bullet {
      position: absolute;
      width: 20px;           /* Amplada base (abans d'escalar) */
      height: auto;
      transform-origin: center center;
    }
  </style>
</head>
<body>
  
  <!-- Distribució principal: 3 columnes -->
  <div class="main-container">
    
    <!-- Columna ESQUERRA -->
    <div class="side-panel" id="leftPanel">
      <!-- Botó pujar P1 -->
      <button class="up-button" id="btnUpP1">P1 ↑</button>
      <!-- Marcador P1 (impactes encertats a P2) -->
      <div class="score" id="scoreP1"></div>
      <!-- Botó baixar P1 -->
      <button class="down-button" id="btnDownP1">P1 ↓</button>
    </div>

    <!-- Contenidor de joc al mig -->
    <div class="game-container" id="gameContainer">
      <img id="player1" class="character" src="P1.png" alt="Jugador 1" />
      <img id="player2" class="character" src="P2.png" alt="Jugador 2" />
    </div>

    <!-- Columna DRETA -->
    <div class="side-panel" id="rightPanel">
      <!-- Botó pujar P2 -->
      <button class="up-button" id="btnUpP2">P2 ↑</button>
      <!-- Marcador P2 (impactes encertats a P1) -->
      <div class="score" id="scoreP2"></div>
      <!-- Botó baixar P2 -->
      <button class="down-button" id="btnDownP2">P2 ↓</button>
    </div>

  </div>

  <script>
    /*
      Paràmetres configurables per codi (no modificables per l’usuari):
    */
    const VELOCITY = 8;          // Velocitat de moviment en amunt/avall
    const SCALE = 3.5;           // Escala de personatges i bales (1 = mida base)
    const SCORE_FONT_SIZE = 80;  // Mida de la lletra del marcador

    // -- Referències a elements --
    const gameContainer = document.getElementById("gameContainer");
    const player1 = document.getElementById("player1");
    const player2 = document.getElementById("player2");

    // Botons P1
    const btnUpP1 = document.getElementById("btnUpP1");
    const btnDownP1 = document.getElementById("btnDownP1");

    // Botons P2
    const btnUpP2 = document.getElementById("btnUpP2");
    const btnDownP2 = document.getElementById("btnDownP2");

    // Marcadors
    const scoreP1 = document.getElementById("scoreP1");  // Impactes de P1 a P2
    const scoreP2 = document.getElementById("scoreP2");  // Impactes de P2 a P1

    // Valors inicials de marcador
    let p1Hits = 0;
    let p2Hits = 0;

    // Posicions verticals i velocitats
    let p1Y = 0;
    let p2Y = 0;
    let p1VelocityY = 0;
    let p2VelocityY = 0;

    // Ajustem estil dels marcadors (mida font)
    scoreP1.style.fontSize = SCORE_FONT_SIZE + "px";
    scoreP2.style.fontSize = SCORE_FONT_SIZE + "px";

    // Escalem personatges
    player1.style.transform = `scale(${SCALE})`;
    player2.style.transform = `scale(${SCALE})`;

    // Centrar personatges verticalment
    function centerCharacters() {
      const containerHeight = gameContainer.clientHeight;
      // Alçades reals un cop aplicat scale
      p1Y = (containerHeight - player1.offsetHeight) / 2;
      p2Y = (containerHeight - player2.offsetHeight) / 2;
      player1.style.top = p1Y + "px";
      player2.style.top = p2Y + "px";
    }

    window.addEventListener("load", centerCharacters);
    window.addEventListener("resize", centerCharacters);

    // Moviment continu en un bucle
    function animate() {
      requestAnimationFrame(animate);
      updatePositions();
    }

    function updatePositions() {
      const containerHeight = gameContainer.clientHeight;
      const p1MaxY = containerHeight - player1.offsetHeight;
      const p2MaxY = containerHeight - player2.offsetHeight;

      // Actualitzem posició de P1
      p1Y += p1VelocityY;
      if (p1Y < 0) p1Y = 0;
      if (p1Y > p1MaxY) p1Y = p1MaxY;
      player1.style.top = p1Y + "px";

      // Actualitzem posició de P2
      p2Y += p2VelocityY;
      if (p2Y < 0) p2Y = 0;
      if (p2Y > p2MaxY) p2Y = p2MaxY;
      player2.style.top = p2Y + "px";
    }

    animate();

    // Moure P1 amunt/avall mentre es prem el botó
    btnUpP1.addEventListener("mousedown", () => p1VelocityY = -VELOCITY);
    btnUpP1.addEventListener("mouseup",   () => p1VelocityY = 0);
    btnUpP1.addEventListener("mouseleave",() => p1VelocityY = 0);

    btnDownP1.addEventListener("mousedown", () => p1VelocityY = VELOCITY);
    btnDownP1.addEventListener("mouseup",   () => p1VelocityY = 0);
    btnDownP1.addEventListener("mouseleave",() => p1VelocityY = 0);

    // Moure P2 amunt/avall mentre es prem el botó
    btnUpP2.addEventListener("mousedown", () => p2VelocityY = -VELOCITY);
    btnUpP2.addEventListener("mouseup",   () => p2VelocityY = 0);
    btnUpP2.addEventListener("mouseleave",() => p2VelocityY = 0);

    btnDownP2.addEventListener("mousedown", () => p2VelocityY = VELOCITY);
    btnDownP2.addEventListener("mouseup",   () => p2VelocityY = 0);
    btnDownP2.addEventListener("mouseleave",() => p2VelocityY = 0);

    // Disparar amb doble clic
    btnUpP1.addEventListener("dblclick", () => shootBullet("P1"));
    btnDownP1.addEventListener("dblclick", () => shootBullet("P1"));
    btnUpP2.addEventListener("dblclick", () => shootBullet("P2"));
    btnDownP2.addEventListener("dblclick", () => shootBullet("P2"));

    // Funció col·lisió (rectangle vs rectangle)
    function isColliding(rectA, rectB) {
      return (
        rectA.left < rectB.right &&
        rectA.right > rectB.left &&
        rectA.top < rectB.bottom &&
        rectA.bottom > rectB.top
      );
    }

    // Disparar una bala
    function shootBullet(shooter) {
      // So de tret
      const shootSound = new Audio("tret.mp3");
      shootSound.play();

      const bullet = document.createElement("img");
      bullet.src = "bala.png";
      bullet.classList.add("bullet");
      gameContainer.appendChild(bullet);

      // Escala la bala igual que els personatges
      bullet.style.transform = `scale(${SCALE})`;

      // Posició de sortida i direcció
      let startX, startY, direction;
      const bulletSpeed = 5;

      if (shooter === "P1") {
        startX = player1.offsetLeft + player1.offsetWidth;
        startY = p1Y + player1.offsetHeight / 2 - 10;
        direction = 1; // dreta
      } else {
        startX = player2.offsetLeft - 20;
        startY = p2Y + player2.offsetHeight / 2 - 10;
        direction = -1; // esquerra
      }

      bullet.style.left = startX + "px";
      bullet.style.top = startY + "px";

      function moveBullet() {
        const currentX = parseInt(bullet.style.left);
        const newX = currentX + direction * bulletSpeed;
        bullet.style.left = newX + "px";

        const bulletRect = bullet.getBoundingClientRect();
        const target = (shooter === "P1") ? player2 : player1;
        const targetRect = target.getBoundingClientRect();

        // Col·lisió
        if (isColliding(bulletRect, targetRect)) {
          // So d'impacte
          const hitSound = new Audio("tocat.mp3");
          hitSound.play();

          // Incrementar marcador
          if (shooter === "P1") {
            p1Hits++;
            scoreP1.textContent = p1Hits;
          } else {
            p2Hits++;
            scoreP2.textContent = p2Hits;
          }
          bullet.remove();
          return;
        }

        // Si surt del contenidor
        if (newX < 0 || newX > gameContainer.clientWidth) {
          bullet.remove();
        } else {
          requestAnimationFrame(moveBullet);
        }
      }

      requestAnimationFrame(moveBullet);
    }
  </script>
</body>
</html>